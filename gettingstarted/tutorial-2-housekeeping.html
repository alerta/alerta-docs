<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alert timeouts, heartbeats and Housekeeping &mdash; Alerta 9.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Alerta
          </a>
              <div class="version">
                9.0.0rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Principles 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server.html">Server &amp; API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webui.html">Alerta Web UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Alerta CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extensions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plug-ins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrations.html">Integrations &amp; Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webhooks.html">Custom Webhooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customer-views.html">Customer Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../federated.html">Federated Alerta</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/query-syntax.html">API Query Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/alert.html">Alert Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/heartbeat.html">Heartbeat Format</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Alerta</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Alert timeouts, heartbeats and Housekeeping</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/gettingstarted/tutorial-2-housekeeping.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="alert-timeouts-heartbeats-and-housekeeping">
<span id="tutorial-2"></span><h1>Alert timeouts, heartbeats and Housekeeping<a class="headerlink" href="#alert-timeouts-heartbeats-and-housekeeping" title="Permalink to this heading"></a></h1>
<p>In this tutorial, you will learn how and why to set timeout
values for alerts, how heartbeats can be used to verify system
health and what housekeeping tasks need to be configured
to support both of these features.</p>
<p><strong>Contents</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#overview">Overview</a></p></li>
<li><p><a class="reference internal" href="#prerequisites">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#step-1-housekeeping">Step 1: Housekeeping</a></p></li>
<li><p><a class="reference internal" href="#step-2-alert-timeouts">Step 2: Alert timeouts</a></p></li>
<li><p><a class="reference internal" href="#step-3-heartbeats">Step 3: Heartbeats</a></p></li>
<li><p><a class="reference internal" href="#next-steps">Next Steps</a></p></li>
</ul>
</div></blockquote>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>Alert timeout values can be used to automatically “expire” alerts
that are no longer active. Timeouts can be used for any type of
alert but are most useful for alerts which do not have a corresponding
“clear” or “ok” state, such as syslog messages. Timeouts are set on
a per-alert basis.</p>
<p>Heartbeats can be sent from any source or by a proxy on behalf of any
source. They are sent at regular intervals within a specified timeout
period otherwise they are considered to be stale. Stale heartbeats
can be used to generate alerts or availability reports.</p>
<p>Processing alert and heartbeat timeouts requires a scheduled cron job.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>It is assumed that you have completed <a class="reference internal" href="tutorial-1-deploy-alerta.html#tutorial-1"><span class="std std-ref">Tutorial 1</span></a>
where you installed and configured a basic Alerta instance or you have
access to a similarly configured Alerta server.</p>
</section>
<section id="step-1-housekeeping">
<h2>Step 1: Housekeeping<a class="headerlink" href="#step-1-housekeeping" title="Permalink to this heading"></a></h2>
<p>To work with alert timeouts you first need to setup a regular housekeeping
job that runs every minute to expire and delete alerts. The alerta
command-line client supports this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta housekeeping
</pre></div>
</div>
<p>Add the <cite>cron</cite> entry to run every minute as root (the root user is used
to keep the tutorial simple however there is nothing about what the
script does that actually requires root access):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo &quot;* * * * * root /usr/bin/alerta housekeeping&quot; &gt;/etc/cron.d/alerta
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Your path to the alerta command-line tool may be different. Check
the path with <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">which</span> <span class="pre">alerta</span></code></p>
</div>
</section>
<section id="step-2-alert-timeouts">
<h2>Step 2: Alert Timeouts<a class="headerlink" href="#step-2-alert-timeouts" title="Permalink to this heading"></a></h2>
<p>The default timeout period for an alert is 86400 seconds, or one day.
This means that one day after the alert is last received it should be
considered to be stale and the status changed to “expired”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The alert <code class="docutils literal notranslate"><span class="pre">lastReceiveTime</span></code> is used to determine alert expiry. This
is so that alerts that continue to be sent within the timeout period
will never expire.</p>
</div>
<p>In addition to expiring timed-out alerts, the script in step 1 is
also responsible for deleting “closed” or “expired” alerts more than
2 hours old and deleting alerts with severity “informational” that
are more than 12 hours old.</p>
<p>Both of these actions can be changed to suit your environment, either
by adjusting the thresholds for deletion or not deleting at all.</p>
<p>Send a test alert with a short timeout period and verify that once the
timeout period has been exceeded the status is changed to “expired”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta send -r user01 -e fail -s major -E Code -S Security \
-t &#39;user01 login failed.&#39; --timeout 20
</pre></div>
</div>
</section>
<section id="step-3-heartbeats">
<h2>Step 3: Heartbeats<a class="headerlink" href="#step-3-heartbeats" title="Permalink to this heading"></a></h2>
<p>Heartbeats can be sent to the Alerta API using the command-line tool, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta heartbeat --origin dc1-oem-01 --timeout 60
</pre></div>
</div>
<p>To generate alerts from stale heartbeats run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta heartbeats --alert
</pre></div>
</div>
<p>To set the <code class="docutils literal notranslate"><span class="pre">environment</span></code>, <code class="docutils literal notranslate"><span class="pre">severity</span></code>, <code class="docutils literal notranslate"><span class="pre">service</span></code> or <code class="docutils literal notranslate"><span class="pre">group</span></code> for
a heartbeat alert use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta heartbeat -O dc1-oem-02 -E Development -s major -S Core -g Network
</pre></div>
</div>
<p>Add the above command as a cron job so that alerts are generated whenever
a heartbeat is stale or slow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ echo &quot;* * * * * root /usr/local/bin/alerta heartbeats --alert&quot; &gt;&gt;/etc/cron.d/alerta
</pre></div>
</div>
<p>Stale or slow heartbeats can generate alerts, but alerts can also generate heartbeats.
This is useful if a downstream system can only send alerts but you wish to make use
of Alerta heartbeats to keep track of these systems.</p>
<p>Ensure the <code class="docutils literal notranslate"><span class="pre">heartbeat</span></code> plugin is enabled and send an alert with an event of <code class="docutils literal notranslate"><span class="pre">Heartbeat</span></code>
and it will be converted in to a heartbeat:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ alerta send -O net02 -E Development -S Core -g Network -s informational -r net02 -e Heartbeat
98b24ee4-d2be-4b95-b78c-42bb24a463f8 (Alert converted to heartbeat)
</pre></div>
</div>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading"></a></h2>
<p>After you setup your housekeeping jobs, you might want to try some of
the following tutorials:</p>
<ul class="simple">
<li><p>Configure a plugin to notify a Slack Channel</p></li>
<li><p>Send alerts to the Alerta API using the command-line tool</p></li>
<li><p>Create filtered alert views for different customers</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2023, Nick Satterly. Creative Commons Attribution-ShareAlike 3.0 License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>